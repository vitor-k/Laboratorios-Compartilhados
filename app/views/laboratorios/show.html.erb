<p id="notice"><%= notice %></p>

<h5> Página do Laboratório </h5>
<h2><%= @laboratorio.nome %> - <%= @laboratorio.localizacao %></h2>
<%= @laboratorio.descricao %>

<p>
  <strong>Responsável:</strong>
  <% if @responsavel == "sem_responsavel" %>
    Sem responsável
  <% else %>
    <%= @responsavel.nome %>
  <% end %>
</p>
<br>

<%= form_with(model: @laboratorio, method: :get, url: :busca_laboratorio, local: true) do |f| %>
  <div class="form-row">
    <div class="col-7">
    <%= f.text_field :termo, placeholder: 'Pesquisar serviço, equipamento ou postagem no laboratório', class: 'form-control' %>
    </div>
    <div class="col">
    <%= f.submit 'Pesquisar', name: nil, class: 'btn btn-primary' %>
    </div>
  </div>
<% end %>

<% if (@user == @responsavel || admin_signed_in?)%>
  <p>
    <strong>Pedidos em espera:</strong>
    <%= Pedido.where("laboratorio_id = ? AND aceito = ?", @laboratorio.id, false).count() %>
  </p>

  <p>
    <strong>Pedidos aceitos:</strong>
    <%= @laboratorio.numero_aceitos %>
  </p>

  <p>
    <strong>Pedidos rejeitados:</strong>
    <%= @laboratorio.numero_rejeitados %>
  </p>
<% end %>


<% if (@user == @responsavel || admin_signed_in?) %>  
    <%= link_to "Modificar dados", edit_laboratorio_path(@laboratorio) %>
<% end %>

<br>

<div class="list-group">
<%= link_to "Lista de equipamentos", laboratorio_equipamentos_path(@laboratorio), class: 'list-group-item list-group-item-action' %>
<%= link_to "Lista de serviços", laboratorio_servicos_path(@laboratorio), class: 'list-group-item list-group-item-action' %>
<%= link_to "Lista de vinculos", laboratorio_vinculo_index_path(@laboratorio), class: 'list-group-item list-group-item-action' %>
<%= link_to "Lista de pedidos", show_laboratorio_pedidos_path(@laboratorio), class: 'list-group-item list-group-item-action' %>
</div>
<br>
<% if lab_has_postagem? %>
<h2> Postagens </h2> 
<% end %>

<table class="table">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Título</th>
      <th scope="col">Autor</th>
      <th scope="col">Link para a postagem</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <% Postagem.all.each do |postagem|%>
      <tr>  
      <% if postagem.laboratorio_id == @laboratorio.id then %>
        <td> <%= postagem.titulo %> </td>
        <td> <%= postagem.user.nome %> </td>
        <td><%= link_to 'Mostrar', postagem %></td>
      <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<p><%= link_to "Lista de laboratórios", laboratorios_path %></p>